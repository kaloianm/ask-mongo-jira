[openai]
system_prompt = """
You are a Senior Staff Software Engineer at MongoDB.
You are using your expertise in MongoDB's core server architecture and codebase to answer questions about Jira issues and their code changes.
You will be given prompts with these pieces of information:
 - Question prompt and context
 - Set of allowed answer choices
 - Jira ticket's summary, description and Git diff output extended with up to 50 lines of surrounding code for context

Your task is to analyze the provided information, select the most appropriate answer choice and provide justification for your selection according to the question prompt.

In your answers, you will strictly follow the requested structured output format.
"""

[analysis_questions]

[analysis_questions.categorize]
version = 2
prompt = """
**Question Context:**
Categorize the main purpose of the Jira issue based on the following criteria:

It is "Catalog CRUD" if one or more of the following apply:
 - Reads directly from the durable shard local catalog (e.g. `_mdb_catalog` or the `config.cache.databases/collections/chunks` and etc collections)
 - Reads from the shard local catalog caches (e.g. `CollectionCatalog`, `AutoGet*`, `acquireCollection*`, `DatabaseShardingState`, `CollectionShardingState`, `ShardingState`)
 - Performs database/collection locking in intent mode (IS or IX)
 - Reads from the durable global catalog (e.g. the `config.databases/collections/chunks` and etc collections)
 - Reads from the global catalog caches (e.g. `CatalogCache`)
 - Performs shard version retries

It is "Catalog DDL" if, in addition to the "Catalog CRUD" criteria above, one or more of the following apply:
 - Modifies files in `src/mongo/s` (weak signal, but often true)
 - Modifies files in `src/mongo/db/s/` (weak signal, but often true)
 - Writes to the the durable shard local catalog (e.g. `_mdb_catalog` or the `config.cache.databases/collections/chunks` and etc collections)
 - Writes to the shard local catalog caches (e.g., `CollectionCatalog`'s write methods, `DatabaseShardingRuntime`, `CollectionShardingRuntime`, `ShardingState/Runtime`'s write methods)
 - Performs database/collection locking for write (X mode)
 - Enters/leaves the critical section
 - Writes to the durable global catalog (e.g. the `config.databases/collections/chunks` collections)
 - Introduces or modifies DDL coordinator classes or DDL command implementations

An issue is "Catalog Implementation Change" if one or more of the following apply:
 - Modifies files in `src/mongo/s` (weak signal, but often true)
 - Modifies files in `src/mongo/db/s/` (weak signal, but often true)
 - Modifies catalog interfaces or their implementations (e.g., `CollectionCatalog`, `DatabaseShardingState/Runtime`, `CollectionShardingState/Runtime`, `ShardingState/Runtime`)
 - Observes oplog entries for catalog changes via ShardServerOpObserver or ConfigServerOpObserver
 - Modifies catalog cache interfaces (e.g. `CatalogCache`, `ConfigServerCatalogCacheLoader`, `ShardServerCatalogCacheLoader`)

An issue is "Data Movement" if one or more of the following apply:
 - Likely fulfills the criteria for "Catalog CRUD"
 - Tails the oplog and inspects oplog entries (e.g. `repl::OpTypeEnum`)

An issue is "Something Else" if none of the above criteria apply.

**Output Format:**
Classification: [Catalog CRUD | Catalog DDL | Catalog Implementation Change | Data Movement | Something Else]

Reasoning: [2-3 sentences explaining why, citing specific files, functions, or patterns from the diff]
"""
template = """
**JIRA issue**
Issue: {issue_key}
Summary: {issue_summary}
Description: {issue_description}

**Commit diffs**
{commit_diffs}
"""
